!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).ytSearch=e()}(function(){return function l(r,u,o){function s(t,e){if(!u[t]){if(!r[t]){var i="function"==typeof require&&require;if(!e&&i)return i(t,!0);if(c)return c(t,!0);var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}var a=u[t]={exports:{}};r[t][0].call(a.exports,function(e){return s(r[t][1][e]||e)},a,a.exports,l,r,u,o)}return u[t].exports}for(var c="function"==typeof require&&require,e=0;e<o.length;e++)s(o[e]);return s}({1:[function(s,e,t){"use strict";function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var G=s("cheerio"),c=s("dasu");s("async.parallellimit");c.follow=!1,c.debug=!1;var W=s("jsonpath"),d="Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html) (yt-search; https://www.npmjs.com/package/yt-search)",v=s("url"),i={};Object.keys(process.env).forEach(function(e){var t=process.env[e];if("0"==t||"false"==t||!t)return i[e]=!1;i[e]=t});var p=i.debug;function X(){p&&console.log.apply(this,arguments)}var n,y=s("querystring"),g=s("human-time"),Q={YT:"https://youtube.com",SEARCH_MOBILE:"https://m.youtube.com/results",SEARCH_DESKTOP:"https://www.youtube.com/results"};function a(e,t){if(!t)return new Promise(function(i,n){a(e,function(e,t){return e?n(e):void i(t)})});var i="string"==typeof e?{query:e}:e;if(i.userAgent&&(d=i.userAgent),i.search=i.query||i.search,i.original_search=i.search,i.videoId)return function(e,a){var t;X("fn: getVideoMetaData"),"string"==typeof e&&(t=e);"object"===l(e)&&(t=e.videoId);var i="https://www.youtube.com/watch?hl=en&gl=US&v="+t,n=v.parse(i);n.headers={"user-agent":d,accept:"text/html","accept-encoding":"gzip","accept-language":"en-US"},n.headers["user-agent"]="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.1.1 Safari/605.1.15",c.req(n,function(e,t,i){if(e)a(e);else{if(200!==t.status)return a("http status: "+t.status);var n;p&&(n=s("fs"),s("path"),n.writeFileSync("dasu.response",t.responseText,"utf8"));try{!function(e,t){X("_parseVideoInitialData");var i=j(_(/ytInitialData.*=\s*{/,e),"{","}");if(!i)return t("could not find inital data in the html document");var n=j(_(/ytInitialPlayerResponse.*=\s*{/,e),"{","}");if(!n)return t("could not find inital player data in the html document");var a=JSON.parse(i),l=JSON.parse(n),r=W.value(a,"$..currentVideoEndpoint..videoId");if(!r)return t("video unavailable");if("ERROR"===W.value(l,"$..status")||"Video unavailable"===W.value(l,"$..reason"))return t("video unavailable");var u=W.value(a,"$..videoPrimaryInfoRenderer..title..text")||W.value(a,"$..videoPrimaryInfoRenderer..title..simpleText")||W.value(a,"$..videoPrimaryRenderer..title..text")||W.value(a,"$..videoPrimaryRenderer..title..simpleText")||W.value(a,"$..title..text")||W.value(a,"$..title..simpleText"),o=W.query(a,"$..description..text").join("")||W.query(l,"$..description..simpleText").join("")||W.query(l,"$..microformat..description..simpleText").join("")||W.query(l,"$..videoDetails..shortDescription").join(""),s=W.value(a,"$..owner..title..text")||W.value(a,"$..owner..title..simpleText"),c=W.value(a,"$..owner..navigationEndpoint..url")||W.value(a,"$..owner..title..url"),d="https://i.ytimg.com/vi/"+r+"/hqdefault.jpg",v=Z(function(e){var t="",i=Math.floor(e/36e5),n=Math.floor(e/6e4)%60,a=Math.floor(e/1e3)%60;i&&(t+=i+":");n&&(t+=n+":");String(a).length<2&&(t+="0");return t+=a}(1e3*Number(W.value(l,"$..videoDetails..lengthSeconds")))),p=W.value(a,"$..sentimentBar..tooltip").split(/[,.]/).join("").split(/\D+/),f=(Number(p[0]),Number(p[1]),W.value(a,"$..uploadDate")||W.value(a,"$..dateText..simpleText")),h=f&&g(new Date(f))||"",m={title:u,description:o,url:Q.YT+"/watch?v="+r,videoId:r,seconds:Number(v.seconds),timestamp:v.timestamp,duration:v,views:Number(W.value(l,"$..videoDetails..viewCount")),genre:(W.value(l,"$..category")||"").toLowerCase(),uploadDate:S(f),ago:h,image:d,thumbnail:d,author:{name:s,url:Q.YT+c}};t(null,m)}(i,a)}catch(e){a(e)}}})}(i.videoId,t);if(i.listId)return function(e,a){var t;X("fn: getPlaylistMetaData"),"string"==typeof e&&(t=e);"object"===l(e)&&(t=e.listId||e.playlistId);var i="https://www.youtube.com/playlist?hl=en&gl=US&list="+t,n=v.parse(i);n.headers={"user-agent":d,accept:"text/html","accept-encoding":"gzip","accept-language":"en-US"},c.req(n,function(e,t,i){if(e)a(e);else{if(200!==t.status)return a("http status: "+t.status);var n;p&&(n=s("fs"),s("path"),n.writeFileSync("dasu.response",t.responseText,"utf8"));try{!function(e,t){X("fn: parsePlaylistBody");var i=e.match(/ytInitialData.*=\s*({.*});/)[1];if(!i)throw new Error("failed to parse ytInitialData json data");var n=JSON.parse(i),a=W.value(n,"$..microformat..urlCanonical").split("=")[1],l=W.value(n,"$..sidebar.playlistSidebarRenderer.items[0]..stats[1].simpleText").match(/\d+/),r=W.query(n,"$..contents..tabs[0]..contents[0]..contents[0]..contents")[0],u=[];r.forEach(function(e){var t=e,i={title:W.value(t,"$..title..simpleText")||W.value(t,"$..title..text")||W.query(item,"$..title..text").join(""),videoId:W.value(t,"$..videoId"),listId:a,thumbnail:W.value(t,"$..thumbnail..thumbnails[0]..url").split("?")[0],author:{name:W.value(t,"$..shortBylineText..runs[0]..text"),url:"https://youtube.com"+W.value(t,"$..shortBylineText..runs[0]..url")}};u.push(i)});var o={title:W.value(n,"$..microformat..title"),listId:a,url:"https://youtube.com/playlist?list="+a,views:Number(l),date:function(e){X("fn: _parsePlaylistLastUpdateTime");for(var t=e.trim().split(/[\s.-]+/),i=0;i<t.length;i++){var n=t.slice(i),a=n.join(" "),l=n.reverse().join(" "),r=new Date(a),u=new Date(l);if("Invalid Date"!==r.toString())return S(r);if("Invalid Date"!==u.toString())return S(u)}return""}(W.value(n,"$..sidebar.playlistSidebarRenderer.items[0]..stats[2]..simpleText")||W.query(n,"$..sidebar.playlistSidebarRenderer.items[0]..stats[2]..text").join("")||""),image:u[0].thumbnail,thumbnail:u[0].thumbnail,videos:u,author:{name:W.value(n,"$..videoOwner..title..runs[0]..text"),url:"https://youtube.com"+W.value(n,"$..videoOwner..navigationEndpoint..url")}};t&&t(null,o)}(i,a)}catch(e){a(e)}}})}(i.listId,t);if(!i.search)return t(Error("yt-search: no query given"));!function f(h,m){var e=y.escape(h.search).split(/\s+/);var t=h.hl||"en";var i=h.gl||"US";var n=h.category||"";var a=Number(h.pageStart)||1;var l=Number(h.pageEnd)||Number(h.pages)||1;a<=0&&(a=1)<=l&&(l+=1);Number.isNaN(l)&&m("error: pageEnd must be a number");h.pageStart=a;h.pageEnd=l;h.currentPage=h.currentPage||a;var r="?";r+="search_query="+e.join("+");-1===r.indexOf("&hl=")&&(r+="&hl="+t);-1===r.indexOf("&gl=")&&(r+="&gl="+i);n&&(r+="&category="+n);h.sp&&(r+="&sp="+h.sp);var u=Q.SEARCH_DESKTOP+r;var o=v.parse(u);o.headers={"user-agent":d,accept:"text/html","accept-encoding":"gzip","accept-language":"en-US"};X(o);X("getting results: "+h.currentPage);c.req(o,function(e,t,i){if(e)m(e);else{if(200!==t.status)return m("http status: "+t.status);var n;p&&(n=s("fs"),s("path"),n.writeFileSync("dasu.response",t.responseText,"utf8"));try{I(i,function(e,t){if(e)return m(e);var i=t,n=i.filter(x),a=i.filter($),l=i.filter(b),r=i.filter(T),u=i.filter(w);h._data=h._data||{},h._data.videos=h._data.videos||[],h._data.playlists=h._data.playlists||[],h._data.channels=h._data.channels||[],h._data.live=h._data.live||[],h._data.all=h._data.all||[],n.forEach(function(e){h._data.videos.push(e)}),a.forEach(function(e){h._data.playlists.push(e)}),l.forEach(function(e){h._data.channels.push(e)}),r.forEach(function(e){h._data.live.push(e)}),u.forEach(function(e){h._data.all.push(e)}),h.currentPage++;var o,s,c,d,v,p=h.currentPage<=h.pageEnd;p&&t._sp?(h.sp=t._sp,setTimeout(function(){f(h,m)},2500)):(o=h._data.videos.filter(x),s=h._data.playlists.filter($),c=h._data.channels.filter(b),d=h._data.live.filter(T),v=h._data.all.slice(w),m(null,{all:v,videos:o,live:d,playlists:s,lists:s,accounts:c,channels:c}))})}catch(e){m(e)}}})}(i,t)}function x(e,t,i){if("video"!==e.type)return!1;var n=e.videoId;return i.findIndex(function(e){return n===e.videoId})===t}function $(e,t,i){if("list"!==e.type)return!1;var n=e.listId;return i.findIndex(function(e){return n===e.listId})===t}function b(e,t,i){if("channel"!==e.type)return!1;var n=e.url;return i.findIndex(function(e){return n===e.url})===t}function T(e,t,i){if("live"!==e.type)return!1;var n=e.videoId;return i.findIndex(function(e){return n===e.videoId})===t}function w(e,t,i){switch(e.type){case"video":case"list":case"channel":case"live":break;default:return!1}var n=e.url;return i.findIndex(function(e){return n===e.url})===t}function I(e,t){var n=/{.*}/,i=G.load(e),a=i("div#initial-data").html()||"";if(!(a=n.exec(a)||""))for(var l=i("script"),r=0;r<l.length;r++){i(l[r]).html().split("\n").forEach(function(e){for(var t;0<=(t=e.indexOf("ytInitialData"));){e=e.slice(t+"ytInitialData".length);var i=n.exec(e);i&&i.length>a.length&&(a=i)}})}if(!a)return t("could not find inital data in the html document");var u=[],o=[],s=JSON.parse(a[0]),c=W.query(s,"$..itemSectionRenderer..contents.*");X("items.length: "+c.length);for(var d=0;d<c.length;d++){var v=c[d],p=void 0,f="unknown",h=v.compactPlaylistRenderer||v.playlistRenderer,m=v.compactChannelRenderer||v.channelRenderer,y=v.compactVideoRenderer||v.videoRenderer,g=h&&W.value(v,"$..playlistId"),x=m&&W.value(v,"$..channelId"),$=y&&W.value(v,"$..videoId");$&&(f="video"),x&&(f="channel"),g&&(f="list"),0<=W.query(v,"$..viewCountText..text").join("").indexOf("watching")&&(f="live");try{switch(f){case"video":var b=ee(W.value(v,"$..thumbnail..url"))||ee(W.value(v,"$..thumbnails..url"))||ee(W.value(v,"$..thumbnails")),T=W.value(v,"$..title..text")||W.value(v,"$..title..simpleText"),w=W.value(v,"$..shortBylineText..text")||W.value(v,"$..longBylineText..text"),I=W.value(v,"$..shortBylineText..url")||W.value(v,"$..longBylineText..url"),S=W.value(v,"$..publishedTimeText..text")||W.value(v,"$..publishedTimeText..simpleText"),_=W.value(v,"$..viewCountText..text")||W.value(v,"$..viewCountText..simpleText")||"0",j=Number(_.split(/\s+/)[0].split(/[,.]/).join("").trim()),q=Z(W.value(v,"$..lengthText..text")||W.value(v,"$..lengthText..simpleText")||"0:00"),D=W.query(v,"$..description..text").join("")||W.query(v,"$..descriptionSnippet..text").join(""),p={type:"video",videoId:$,url:Q.YT+"/watch?v="+$,title:T.trim(),description:D,image:b,thumbnail:b,seconds:Number(q.seconds),timestamp:q.timestamp,duration:q,ago:S,views:Number(j),author:{name:w,url:Q.YT+I}};break;case"list":var E=ee(W.value(v,"$..thumbnail..url"))||ee(W.value(v,"$..thumbnails..url"))||ee(W.value(v,"$..thumbnails")),N=W.value(v,"$..title..text")||W.value(v,"$..title..simpleText"),C=W.value(v,"$..shortBylineText..text")||W.value(v,"$..longBylineText..text")||W.value(v,"$..shortBylineText..simpleText")||W.value(v,"$..longBylineText..simpleTextn")||"YouTube",O=W.value(v,"$..shortBylineText..url")||W.value(v,"$..longBylineText..url")||"",B=W.value(v,"$..videoCountShortText..text")||W.value(v,"$..videoCountText..text")||W.value(v,"$..videoCountShortText..simpleText")||W.value(v,"$..videoCountText..simpleText")||W.value(v,"$..thumbnailText..text")||W.value(v,"$..thumbnailText..simpleText");p={type:"list",listId:g,url:Q.YT+"/playlist?list="+g,title:N.trim(),image:E,thumbnail:E,videoCount:B,author:{name:C,url:Q.YT+O}};break;case"channel":var R=ee(W.value(v,"$..thumbnail..url"))||ee(W.value(v,"$..thumbnails..url"))||ee(W.value(v,"$..thumbnails")),P=W.value(v,"$..title..text")||W.value(v,"$..title..simpleText")||W.value(v,"$..displayName..text"),M=W.value(v,"$..shortBylineText..text")||W.value(v,"$..longBylineText..text")||W.value(v,"$..displayName..text")||W.value(v,"$..displayName..simpleText"),k=W.value(v,"$..videoCountText..text")||W.value(v,"$..videoCountText..simpleText")||"0",Y=W.value(v,"$..subscriberCountText..text")||W.value(v,"$..subscriberCountText..simpleText");"string"==typeof Y&&(Y=Y.split(/\s+/).filter(function(e){return e.match(/\d/)})[0]);var U=W.value(v,"$..navigationEndpoint..url")||"/user/"+P;p={type:"channel",name:M,url:Q.YT+U,title:P.trim(),image:R,thumbnail:R,videoCount:Number(k.replace(/\D+/g,"")),videoCountLabel:k,subCount:function(e){if(!e)return;var t=e.split(/\s+/).filter(function(e){return e.match(/\d/)})[0].toLowerCase(),i=t.match(/\d+(\.\d+)?/);if(!i||!i[0])return;var n=Number(i[0]);return 0<=t.indexOf("m")?1e6*n:0<=t.indexOf("k")?1e3*n:n}(Y),subCountLabel:Y};break;case"live":var L=ee(W.value(v,"$..thumbnail..url"))||ee(W.value(v,"$..thumbnails..url"))||ee(W.value(v,"$..thumbnails")),A=W.value(v,"$..title..text")||W.value(v,"$..title..simpleText"),V=W.value(v,"$..shortBylineText..text")||W.value(v,"$..longBylineText..text"),z=W.value(v,"$..shortBylineText..url")||W.value(v,"$..longBylineText..url"),F=W.query(v,"$..viewCountText..text").join("")||W.query(v,"$..viewCountText..simpleText").join("")||"0",H=Number(F.split(/\s+/)[0].split(/[,.]/).join("").trim()),J=W.query(v,"$..description..text").join("")||W.query(v,"$..descriptionSnippet..text").join("");p={type:"live",videoId:$,url:Q.YT+"/watch?v="+$,title:A.trim(),description:J,image:L,thumbnail:L,watching:Number(H),author:{name:V,url:Q.YT+z}}}p&&o.push(p)}catch(e){X(e),u.push(e)}}var K=W.value(s,"$..continuation");return o._ctoken=K,u.length?t(u.pop(),o):t(null,o)}function S(e){return e=new Date(e),X("fn: _toInternalDateString"),e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()}function Z(e){var t=e.split(/\s+/),i=t[t.length-1].replace(/[^:.\d]/g,"");if(!i)return{toString:function(){return t[0]},seconds:0,timestamp:0};for(;i[i.length-1].match(/\D/);)i=i.slice(0,-1);for(var n=(i=i.replace(/\./g,":")).split(/[:.]/),a=0,l=0,r=n.length-1;0<=r;r--)if(!(n[r].length<=0)){var u=n[r].replace(/\D/g,"");if(a+=parseInt(u)*(0<l?Math.pow(60,l):1),2<++l)break}return{toString:function(){return a+" seconds ("+i+")"},seconds:a,timestamp:i}}function ee(e){var t;return"string"!=typeof e?e.length?ee(t=e[0]):void 0:0===(t=(t=(t=(t=e).split("?")[0]).split("/default.jpg").join("/hqdefault.jpg")).split("/default.jpeg").join("/hqdefault.jpeg")).indexOf("//")?"https://"+t.slice(2):t.split("http://").join("https://")}function _(e,t){var i=_.cache||{};(_.cache=i)[t]=i[t]||{};var n=i[t].lines||t.split("\n");i[t].lines=n,clearTimeout(i[t].timeout),i[t].timeout=setTimeout(function(){delete i[t]},100);for(var a=0;a<n.length;a++){var l=n[a];if(e.test(l))return l}return""}function j(e,t,i){var n=e.indexOf(t),a=e.lastIndexOf(i);return n<0||a<0?"":e.slice(n,a+1)}e.exports=a,e.exports.search=a,s.main===e&&(n="superman theme list pewdiepie channel",console.log("test: doing list search"),a({query:n,pageEnd:1},function(e,t){if(e)throw e;var i=t.videos,n=t.playlists,a=t.channels;console.log("videos: "+i.length),console.log("playlists: "+n.length),console.log("channels: "+a.length);for(var l=0;l<i.length;l++){var r=i[l],u=" (".concat(r.timestamp,")");console.log(r.title+u)}n.forEach(function(e){console.log("playlist: ".concat(e.title," | ").concat(e.listId))}),a.forEach(function(e){console.log("channel: ".concat(e.title," | ").concat(e.description))})}))},{"async.parallellimit":void 0,cheerio:void 0,dasu:void 0,fs:void 0,"human-time":void 0,jsonpath:void 0,path:void 0,querystring:void 0,url:void 0}]},{},[1])(1)});